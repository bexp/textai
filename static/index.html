<!DOCTYPE html>
<style type="text/css">
.subtext { font-family:Verdana, Geneva, sans-serif; font-size:  7pt; color:#828282; margin-top:3px }
.sublink { font-family:Verdana, Geneva, sans-serif; font-size:  7pt; color:#828282; margin-top:3px }
#sharing {
  position: absolute;
  bottom: 10;
  right: 0;
}
</style>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script id="_webengage_script_tag" type="text/javascript">
var webengage; !function(w,e,b,n,g){function o(e,t){e[t[t.length-1]]=function(){r.__queue.push([t.join("."),arguments])}}var i,s,r=w[b],z=" ",l="init options track screen onReady".split(z),a="feedback survey notification".split(z),c="options render clear abort".split(z),p="Open Close Submit Complete View Click".split(z),u="identify login logout setAttribute".split(z);if(!r||!r.__v){for(w[b]=r={__queue:[],__v:"6.0",user:{}},i=0;i<l.length;i++)o(r,[l[i]]);for(i=0;i<a.length;i++){for(r[a[i]]={},s=0;s<c.length;s++)o(r[a[i]],[a[i],c[s]]);for(s=0;s<p.length;s++)o(r[a[i]],[a[i],"on"+p[s]])}for(i=0;i<u.length;i++)o(r.user,["user",u[i]]);setTimeout(function(){var f=e.createElement("script"),d=e.getElementById("_webengage_script_tag");f.type="text/javascript",f.async=!0,f.src=("https:"==e.location.protocol?"https://ssl.widgets.webengage.com":"http://cdn.widgets.webengage.com")+"/js/webengage-min-v-6.0.js",d.parentNode.insertBefore(f,d)})}}(window,document,"webengage");

webengage.init("~71680151");
</script>
<script>
$(document).ready(function() {
  var HACKER_NEWS_API_V0 = 'https://hacker-news.firebaseio.com/v0/';
  var HN_ITEM_ENDPOINT = HACKER_NEWS_API_V0+'item/';
  var HN_TOP_STORIES_ENDPOINT = HACKER_NEWS_API_V0+'topstories.json';

  var get_summary = function(url, item_id, comments) {
    $.ajax({
      url:"summary",
      type:"POST",
      data:url,
      contentType:"text",
      dataType:"text",
      success: function(response){
        var obj = JSON.parse(response)
        $("#" + item_id).append($("<div>" + obj.text + "</div>").css('margin', 10));
        $("#" + item_id + " div:first").append($("<p/>").text("keywords: "+obj.keywords + " | ").attr('class','subtext'));
        $("#" + item_id + " p:first").append($("<a/>").text(comments + " comments").attr('href', 'http://news.ycombinator.com/item?id=' + item_id).attr('class','sublink'));
      },
      error: function(jqXHR, textStatus, errorThrown ) {
        console.log('request failed :'+ errorThrown);
      }
    });
  }

  var get_story = function(index, item_id) {
    var item_url = HN_ITEM_ENDPOINT + item_id + ".json";
    $.getJSON(item_url).done(function(data) {
        $("#" + item_id).append($("<a/>").text((index + 1).toString() + ". " + data.title)
          .attr("href", data.url)
          .css({'padding-left':'4px', 'color':'#000000', 'text-decoration':'none', 'font-weight':'bold'}));
        get_summary(data.url, item_id, data.descendants);
    }).fail(function() {
        console.log("get_story error");
    });
  }

  $.getJSON(HN_TOP_STORIES_ENDPOINT).done(function(data) {
  	//console.log(data);
    $.each(data, function(index, value){
      if (index > 9) {
        return false;
      }

      $("#content").append($("<div/>").attr("id", value));

      get_story(index, value);
    });
  }).fail(function() {
  	console.log("get top stories error");
  });
});
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-90755048-1', 'auto');
  ga('send', 'pageview');

</script>
</head>
<title>Realtime Summary of Top HackerNews stories</title>
<meta name="description" content="Realtime Summary of HackerNews without you spending time reading it, done with machine learning summarization algorithm">
<body style="background-color:#F6F6EF">
  <h4 style="background-color:#FF6600;padding-left:4px;margin:5px">RealTime Hacker News Summary</h4>
  <div id="content" style="background-color:#F6F6EF"/>
</body>
</html>
