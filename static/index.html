<!DOCTYPE html>
<style type="text/css">
.subtext { font-family:Verdana, Geneva, sans-serif; font-size:  7pt; color:#828282; margin-top:3px }
</style>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script>
$(document).ready(function() {
  var HACKER_NEWS_API_V0 = 'https://hacker-news.firebaseio.com/v0/';
  var HN_ITEM_ENDPOINT = HACKER_NEWS_API_V0+'item/';
  var HN_TOP_STORIES_ENDPOINT = HACKER_NEWS_API_V0+'topstories.json';

  var get_summary = function(url, item_id) {
    $.ajax({
      url:"summary",
      type:"POST",
      data:url,
      contentType:"text",
      dataType:"text",
      success: function(response){
        var obj = JSON.parse(response)
        $("#" + item_id).append($("<div>" + obj.text + "</div>").css('margin', 10));
        $("#" + item_id + " div:first").append($("<p/>").text("keywords: "+obj.keywords).attr('class','subtext'));
      },
      error: function(jqXHR, textStatus, errorThrown ) {
        console.log('request failed :'+ errorThrown);
      }
    });
  }

  var get_story = function(index, item_id) {
    var item_url = HN_ITEM_ENDPOINT + item_id + ".json";
    $.getJSON(item_url).done(function(data) {
        $("#" + item_id).append($("<a/>").text((index + 1).toString() + ". " + data.title)
          .attr("href", data.url)
          .css({'padding-left':'4px', 'color':'#000000', 'text-decoration':'none', 'font-weight':'bold'}));
        get_summary(data.url, item_id);
    }).fail(function() {
        console.log("get_story error");
    });
  }

  $.getJSON(HN_TOP_STORIES_ENDPOINT).done(function(data) {
  	//console.log(data);
    $.each(data, function(index, value){
      if (index > 9) {
        return false;
      }

      $("#content").append($("<div/>").attr("id", value));

      get_story(index, value);
    });
  }).fail(function() {
  	console.log("get top stories error");
  });
});
</script>
</head>
<body style="background-color:#F6F6EF">
  <h4 style="background-color:#FF6600;padding-left:4px;margin:5px">Hacker News TOP 10</h4>
  <div id="content" style="background-color:#F6F6EF"/>
</body>
</html>
