<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="styles.css" media="only screen and (min-device-width: 800px)">
<link rel="stylesheet" href="styles_mobile.css" media="only screen and (max-device-width: 568px)">
<meta name="viewport" content="width=device-width,initial-scale=1">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script id="_webengage_script_tag" type="text/javascript">
var webengage; !function(w,e,b,n,g){function o(e,t){e[t[t.length-1]]=function(){r.__queue.push([t.join("."),arguments])}}var i,s,r=w[b],z=" ",l="init options track screen onReady".split(z),a="feedback survey notification".split(z),c="options render clear abort".split(z),p="Open Close Submit Complete View Click".split(z),u="identify login logout setAttribute".split(z);if(!r||!r.__v){for(w[b]=r={__queue:[],__v:"6.0",user:{}},i=0;i<l.length;i++)o(r,[l[i]]);for(i=0;i<a.length;i++){for(r[a[i]]={},s=0;s<c.length;s++)o(r[a[i]],[a[i],c[s]]);for(s=0;s<p.length;s++)o(r[a[i]],[a[i],"on"+p[s]])}for(i=0;i<u.length;i++)o(r.user,["user",u[i]]);setTimeout(function(){var f=e.createElement("script"),d=e.getElementById("_webengage_script_tag");f.type="text/javascript",f.async=!0,f.src=("https:"==e.location.protocol?"https://ssl.widgets.webengage.com":"http://cdn.widgets.webengage.com")+"/js/webengage-min-v-6.0.js",d.parentNode.insertBefore(f,d)})}}(window,document,"webengage");

 webengage.init("~71680151");
</script>
<script>
$(function() {
  $('#bookmarkme').click(function() {
    if (window.sidebar && window.sidebar.addPanel) { // Mozilla Firefox Bookmark
      window.sidebar.addPanel(document.title, window.location.href, '');
    } else if (window.external && ('AddFavorite' in window.external)) { // IE Favorite
      window.external.AddFavorite(location.href, document.title);
    } else if (window.opera && window.print) { // Opera Hotlist
      this.title = document.title;
      return true;
    } else { // webkit - safari/chrome
      alert('Press ' + (navigator.userAgent.toLowerCase().indexOf('mac') != -1 ? 'Command/Cmd' : 'CTRL') + ' + D to bookmark this page.');
    }
  });
});

$(document).ready(function() {
  var HACKER_NEWS_API_V0 = 'https://hacker-news.firebaseio.com/v0/';
  var HN_ITEM_ENDPOINT = HACKER_NEWS_API_V0+'item/';
  var HN_TOP_STORIES_ENDPOINT = HACKER_NEWS_API_V0+'topstories.json';

  var get_summary = function(url, item_id, comments) {
    $.ajax({
      url:"summary",
      type:"POST",
      data:url,
      contentType:"text",
      dataType:"text",
      success: function(response){
        var obj = JSON.parse(response)
        $("#" + item_id).append($("<div>" + obj.text + "</div>").css('padding-left', 16).css('padding-top', 10).attr('class','bodytext'));
        $("#" + item_id + " div:first").append($("<p/>").text("keywords: " + obj.keywords + " | ").attr('class','subtext'));
        $("#" + item_id + " p:first").append($("<a/>").text(comments + " comments").attr('href', 'http://news.ycombinator.com/item?id=' + item_id).attr('class','sublink'));
        $("#" + item_id).append($("<hr/>"))
      },
      error: function(jqXHR, textStatus, errorThrown ) {
        console.log('request failed :'+ errorThrown);
      }
    });
  }

  var get_story = function(index, item_id) {
    var item_url = HN_ITEM_ENDPOINT + item_id + ".json";
    $.getJSON(item_url).done(function(data) {
	$("#" + item_id).append($("<span/>").text((index + 1).toString() + ". ").attr('class','rank'))
        $("#" + item_id).append($("<a/>").text(data.title)
          .attr("href", data.url)
          .attr("class", "storytitle"));
        get_summary(data.url, item_id, data.descendants);
  
    }).fail(function() {
        console.log("get_story error");
    });
  }

  $.getJSON(HN_TOP_STORIES_ENDPOINT).done(function(data) {
     //console.log(data);
     $.each(data, function(index, value){
      if (/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)) {
         if (index > 19) {
            return false;
     	}
      }

      if (index > 19) {
        return false;
      }

      $("#content").append($("<div/>").attr("id", value).css('padding', '5'));

      get_story(index, value);
    });
  }).fail(function() {
  	console.log("get top stories error");
  });
});
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-90755048-1', 'auto');
  ga('send', 'pageview');

</script>
</head>
<title>Realtime Summary of Top Hacker News Stories</title>
<meta name="description" content="Realtime Summary of Hacker News. Save time by not reading everything. Shield you from Ads">
<body style="background-color:#FFFFFF">
  <div class="container">
    <h4 style="background-color:#FF6600;padding:6px;margin:3px;font-family:Verdana, Geneva, sans-serif; font-size: 10pt;">RealTime Hacker News Summary</h4>
    <a class="bookmark" id="bookmarkme" href="#" rel="sidebar" title="bookmark this page">Bookmark This Page</a>
    <div id="content"/>
  </div>
</body>
</html>
